<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        form.ib {
            display: inline-block;
        }
    </style>
</head>

<body>
    <h1>Customers</h1>

    <form action="/" method="GET" class="ib">
        <input type="submit" value="Home">
    </form>
    | <form action="/add" method="GET" class="ib">
        <input type="submit" value="Add">
    </form>
    {{if .CustomerNotEmpty}}
    | <form action="/edit" method="GET" class="ib">
        <input type="number" name="key" id="key" min="1" max="{{.CustomerSize}}" placeholder="Key" step="1" required>
        <input type="submit" value="Edit">
    </form>
    | <form action="/delete" method="POST" class="ib">
        {{.CSRF}}
        <input type="number" name="key" id="key" min="1" max="{{.CustomerSize}}" placeholder="Key" step="1">
        <input type="submit" value="Delete">
    </form>
    {{end}}
    <hr>
    <ol id="customers">
        <label for="progress-1"><i>Empty List</i></label>
    </ol>
    <script>
        let socket = new WebSocket("ws://localhost:3000/ws");

        socket.onopen = function () {
            console.log("Status: Connected");
        };

        let ol = document.getElementById("customers");
        // the browsers' cpu is here
        socket.onmessage = function (e) {
            let cs = JSON.parse(e.data);
            if (!cs) {
                ol.innerHTML = '<label for="progress-1"><i>Empty List</i></label>';
                return;
            }

            ol.innerHTML = ''; // clear the list
            for (const [k, cust] of cs.entries()) {
                let label = `<label for="progress${k}">${cust.name}</label>`
                let progress =
                    `<progress id="progress${k}" max="${cust.total}" value="${cust.current}"></progress>`

                ol.innerHTML += `<li>${label} ${progress}</li>`;
            }
        };
    </script>
</body>

</html>